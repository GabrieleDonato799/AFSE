<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Album</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        img {
            object-fit: cover;
            min-width: inherit;
            max-width: inherit;
            min-height: inherit;
            max-height: inherit;
            height: inherit;
            width: inherit;
        }

        .card {
            width: 250px;
            height: 400px;
        }
    </style>
</head>

<body class="bg-info">
    <div class="container bg-info">
        <div class="row d-flex justify-content-between">
            <button class="col" onclick='previousPage();'>Pagina precedente</button>
            <button class="col" onclick='nextPage();'>Pagina successiva</button>
        </div>
    </div>
    <div id="container" class="row row-cols-2 g-4 bg-info d-flex justify-content-around">
        <div id="card_film" class="card col-6 col-sm-4 col-md-4 col-lg-3 col-xl-3 col-xxl-2 d-none">
            <h6 id="card_title" class="card-title text-light text-center"></h6>
            <img id="card_image" src="" class="card-img-top" alt="...">
            <!-- <div class="card-body">
                <p id="card_overview" class="card-text"></p>
            </div> -->
            <div class="card-footer">
                <a href="scheda-film.html" class="btn btn-primary">Dettagli</a>
            </div>
        </div>
    </div>
    <div class="container bg-dark">
        <div class="row d-flex justify-content-between">
            <button class="col" onclick='previousPage();'>Pagina precedente</button>
            <button class="col" onclick='nextPage();'>Pagina successiva</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="shared/api_marvel.js"></script>
    <script src="shared/lib.js"></script>
    <script>
        var page = 1;
        var pageSize = 100;
        var user_id = localStorage.getItem("user_id");
        var userAlbum = undefined;

        if(user_id === undefined) throw new Error("Unauthorized");

        // function nextPage(){
        //     page += 1;
        //     getSupercards("public/characters", `limit=${pageSize}&offset=${page*pageSize}`);
        // }

        // function previousPage(){
        //     if(page > 0)
        //         page -= 1;
        //     getSupercards("public/characters", `limit=${pageSize}&offset=${page*pageSize}`);
        // }

        // function getSupercards(path, query){
        //     return _getFromMarvel(path, query).then(
        //         response => { showSupercards(response, userAlbum); }
        //     );
        // }

        // TODO: substitute with the caching mechanism
        // var _getFromMarvel = memoize(getFromMarvel);

        function showSupercards(response){
            card = document.getElementById('card_film');
            container = document.getElementById('container');
            container.innerHTML = "";
            container.append(card);

            for (i = 0; i < response.length; i++) {
                let superhero = response[i];

                clone = card.cloneNode(true);
                clone.id = 'card-film-' + i;

                title = clone.getElementsByClassName('card-title')[0];
                overview = clone.getElementsByClassName('card-text')[0];
                image = clone.getElementsByClassName('card-img-top')[0];
                button = clone.getElementsByClassName('btn-primary')[0];

                title.innerHTML = superhero.name;
                image.src = superhero['thumbnail'];

                // set the rarity color on the supercard
                clone.style.backgroundColor = `#${superhero.rarity}`;

                clone.classList.remove('d-none')
                card.before(clone)
            }
        }
        
        // function getLanguages(){
        //     //https://api.themoviedb.org/3/configuration/languages 
        //     fetch(`https://api.themoviedb.org/3/configuration/languages?api_key=${api_key}`)
        //     .then(response => response.json())
        //     .then(response => mostraLingue(response))
        // }

        async function getUserAlbum(){
            const options = {
                "method": "GET",
                "headers": {
                    "Content-Type": "application/json",
                }
            };

            await fetch(`${url_backend}/album/${user_id}`, options)
                .then(response => {
                    if(response.ok){
                        response.json().then(json => {
                            userAlbum = json['supercards'];
                            showSupercards(userAlbum);
                        })
                    }
                });
        }

        getUserAlbum();
        // getSupercards("public/characters", `limit=${pageSize}&offset=${page*pageSize}`);        
    </script>
</body>
</html>