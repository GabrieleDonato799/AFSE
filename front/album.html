<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Album</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        img {
            object-fit: cover;
            min-width: inherit;
            max-width: inherit;
            min-height: inherit;
            max-height: inherit;
            height: inherit;
            width: inherit;
        }

        .card {
            width: 300px;
            height: 500px;
        }
    </style>
</head>

<body class="bg-info">
    <div class="container bg-info">
        <div class="row d-flex justify-content-between">
            <button class="col" onclick='previousPage();'>Pagina precedente</button>
            <button class="col" onclick='nextPage();'>Pagina successiva</button>
        </div>
    </div>
    <div id="container" class="row row-cols-2 bg-info d-flex justify-content-around">
        <div id="card_film" class="card col-6 col-sm-4 col-md-4 col-lg-3 col-xl-3 col-xxl-2 d-none bg-dark">
            <h6 id="card_title" class="card-title text-light text-center"></h6>
            <img id="card_image" src="" class="card-img-top" alt="...">
            <!-- <div class="card-body">
                <p id="card_overview" class="card-text"></p>
            </div> -->
            <div class="card-footer">
                <a href="scheda-film.html" class="btn btn-primary">Dettagli</a>
            </div>
        </div>
    </div>
    <div class="container bg-dark">
        <div class="row d-flex justify-content-between">
            <button class="col" onclick='previousPage();'>Pagina precedente</button>
            <button class="col" onclick='nextPage();'>Pagina successiva</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="api_marvel.js"></script>
    <script src="utils.js"></script>
    <script>
        var page = 1;
        var pageSize = 100; 

        function nextPage(){
            page += 1;
            getSupercards("public/characters", `limit=${pageSize}&offset=${page*pageSize}`);
        }

        function previousPage(){
            if(page > 0)
                page -= 1;
            getSupercards("public/characters", `limit=${pageSize}&offset=${page*pageSize}`);
        }

        function getSupercards(path, query){
            return _getFromMarvel(path, query).then(
                response => { showSupercards(response); }
            );
        }

        // TODO: substitute with the caching mechanism
        var _getFromMarvel = memoize(getFromMarvel);

        function showSupercards(response){
            card = document.getElementById('card_film');
            container = document.getElementById('container');
            container.innerHTML = "";
            container.append(card);

            for (i = 0; i < response['data']['results'].length; i++) {
                let superhero = response['data']['results'][i];
                if(superhero['thumbnail']['path'].includes("image_not_available"))
                    continue;

                clone = card.cloneNode(true);
                clone.id = 'card-film-' + i;

                title = clone.getElementsByClassName('card-title')[0];
                overview = clone.getElementsByClassName('card-text')[0];
                image = clone.getElementsByClassName('card-img-top')[0];
                button = clone.getElementsByClassName('btn-primary')[0];

                title.innerHTML = superhero.name;
                // overview.innerHTML = superhero.description;
                image.src = superhero['thumbnail']['path'] + "." + superhero['thumbnail']['extension'];
                // button.href = "scheda-film.html?id=" + i;

                clone.classList.remove('d-none')
                card.before(clone)
            }
        }

        getSupercards("public/characters", `limit=${pageSize}&offset=${page*pageSize}`);
        // getPopolari();

        // function getPopolari() {
        //     const options = {
        //         method: 'GET'
        //     };
            
        //     language = document.getElementById('selected_language').value;
        //     page = document.getElementById('selected_page').value;

        //     fetch('https://api.themoviedb.org/3/movie/popular?api_key=' + api_key + '&language=' + language + '&page=' + page, options)
        //         .then(response => response.json())
        //         .then(response => mostraPopolari(response))
        //         .catch(err => console.error(err));
        // }

        // function getLanguages(){
        //     //https://api.themoviedb.org/3/configuration/languages 
        //     fetch(`https://api.themoviedb.org/3/configuration/languages?api_key=${api_key}`)
        //     .then(response => response.json())
        //     .then(response => mostraLingue(response))
        // }

        function ricercaAggiornata() {
            query = document.getElementById('query').value;
            if (query.length > 3) {
                ricerca()
            }else if (query.length === 0){
                console.log("casa")
                getPopolari()
            }
        }
    </script>
</body>
</html>